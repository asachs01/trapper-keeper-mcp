[tox]
envlist = py38,py39,py310,py311,py312,lint,type,docs
isolated_build = True
skip_missing_interpreters = True

[testenv]
deps =
    pytest>=7.4.0
    pytest-asyncio>=0.21.0
    pytest-cov>=4.1.0
    pytest-benchmark>=4.0.0
    pytest-timeout>=2.1.0
    pytest-xdist>=3.3.0
    psutil>=5.9.0
commands =
    pytest {posargs:tests}

[testenv:lint]
deps =
    ruff>=0.1.0
    black>=23.0.0
    isort>=5.12.0
commands =
    ruff check src tests
    black --check src tests
    isort --check-only src tests

[testenv:type]
deps =
    mypy>=1.5.0
    types-PyYAML
    types-aiofiles
commands =
    mypy src

[testenv:docs]
deps =
    sphinx>=6.0.0
    sphinx-rtd-theme>=1.3.0
    sphinx-autodoc-typehints>=1.24.0
commands =
    sphinx-build -b html docs docs/_build/html

[testenv:coverage]
deps =
    {[testenv]deps}
    coverage[toml]>=7.0
commands =
    coverage erase
    pytest --cov=trapper_keeper --cov-report=term-missing --cov-report=html --cov-report=xml
    coverage report --fail-under=90

[testenv:performance]
deps =
    {[testenv]deps}
commands =
    pytest tests/performance -v --benchmark-only

[testenv:integration]
deps =
    {[testenv]deps}
commands =
    pytest tests/integration -v

[testenv:e2e]
deps =
    {[testenv]deps}
commands =
    pytest tests/e2e -v